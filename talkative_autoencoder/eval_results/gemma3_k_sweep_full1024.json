{
  "checkpoint_path": "outputs/checkpoints/gemma3_CHAT_27b_frozen_nopostfix_GG32PAW1S_gemma-3-27b-it_L45_e45_frozen_lr3e-4_t8_4ep_resume_0722_171856_frozenenc_add_patch5_suffix1p0enc_NO_PROJ_IT_E_D_WILD_OTF_dist8/checkpoint_step399999_epoch240_final.pt",
  "eval_config": {
    "checkpoint_path": "outputs/checkpoints/gemma3_CHAT_27b_frozen_nopostfix_GG32PAW1S_gemma-3-27b-it_L45_e45_frozen_lr3e-4_t8_4ep_resume_0722_171856_frozenenc_add_patch5_suffix1p0enc_NO_PROJ_IT_E_D_WILD_OTF_dist8/checkpoint_step399999_epoch240_final.pt",
    "k_values": [
      1,
      2,
      4,
      8,
      16,
      32
    ],
    "max_batches": null,
    "output_dir": "./eval_results",
    "output_file": "gemma3_k_sweep_full_larger.json",
    "batch_size": 8,
    "temperature": 1.0,
    "generation_batch_size": 64,
    "use_bf16": true,
    "dataloader_batch_size": 128,
    "vector_extraction_batch_size": 16,
    "num_positions": 1,
    "max_val_samples": 1024,
    "dataloader_fwd_pass_batch_size": 16
  },
  "results_by_k": [
    {
      "k": 1,
      "avg_mse": 30899.53515625,
      "variance_recovery": 0.7502889633178711,
      "variance_recovery_bias": -0.021712660789489746,
      "variance_recovery_bias_corrected": 0.7720016241073608,
      "variance_recovery_std": 0.07272259145975113,
      "variance_recovery_ci_lower": 0.6325650021433831,
      "variance_recovery_ci_upper": 0.845061831176281,
      "variance_recovery_bca_ci_lower": 0.6391169922952324,
      "variance_recovery_bca_ci_upper": 0.8974705950506828,
      "mse_std": 493.376708984375,
      "mse_ci_lower": 29985.263916015625,
      "mse_ci_upper": 31828.887158203124,
      "r_squared": 0.9659026265144348,
      "r_squared_std": 0.0015136607689782977,
      "r_squared_ci_lower": 0.9634926587343215,
      "r_squared_ci_upper": 0.9689931899309159,
      "total_positions": 1024,
      "original_variance": 906214.5625,
      "original_mean": 15.710368156433105,
      "mean_variance_mean_over_hidden": 30237.904296875,
      "residual_variance_mean_over_hidden": 30237.904296875
    },
    {
      "k": 2,
      "avg_mse": 29696.62890625,
      "variance_recovery": 0.7600265145301819,
      "variance_recovery_bias": -0.020840346813201904,
      "variance_recovery_bias_corrected": 0.7808668613433838,
      "variance_recovery_std": 0.06985310465097427,
      "variance_recovery_ci_lower": 0.6466988041996956,
      "variance_recovery_ci_upper": 0.851308935880661,
      "variance_recovery_bca_ci_lower": 0.6528755713286014,
      "variance_recovery_bca_ci_upper": 0.9011231907994653,
      "mse_std": 476.8539733886719,
      "mse_ci_lower": 28817.7359375,
      "mse_ci_upper": 30647.86982421875,
      "r_squared": 0.9672300219535828,
      "r_squared_std": 0.0014526296872645617,
      "r_squared_ci_lower": 0.9649341717362404,
      "r_squared_ci_upper": 0.9702094689011573,
      "total_positions": 1024,
      "original_variance": 906214.5625,
      "original_mean": 15.710368156433105,
      "mean_variance_mean_over_hidden": 29058.767578125,
      "residual_variance_mean_over_hidden": 29058.767578125
    },
    {
      "k": 4,
      "avg_mse": 29019.42578125,
      "variance_recovery": 0.7654687762260437,
      "variance_recovery_bias": -0.0203210711479187,
      "variance_recovery_bias_corrected": 0.7857898473739624,
      "variance_recovery_std": 0.0681978240609169,
      "variance_recovery_ci_lower": 0.6549006104469299,
      "variance_recovery_ci_upper": 0.8543334111571312,
      "variance_recovery_bca_ci_lower": 0.6614133473975238,
      "variance_recovery_bca_ci_upper": 0.9035161399878405,
      "mse_std": 471.6727600097656,
      "mse_ci_lower": 28092.57509765625,
      "mse_ci_upper": 29962.44638671875,
      "r_squared": 0.9679772853851318,
      "r_squared_std": 0.001415445120073855,
      "r_squared_ci_lower": 0.9656753331422806,
      "r_squared_ci_upper": 0.9708779111504555,
      "total_positions": 1024,
      "original_variance": 906214.5625,
      "original_mean": 15.710368156433105,
      "mean_variance_mean_over_hidden": 28399.755859375,
      "residual_variance_mean_over_hidden": 28399.755859375
    },
    {
      "k": 8,
      "avg_mse": 28468.681640625,
      "variance_recovery": 0.7697436213493347,
      "variance_recovery_bias": -0.019965171813964844,
      "variance_recovery_bias_corrected": 0.7897087931632996,
      "variance_recovery_std": 0.0669286772608757,
      "variance_recovery_ci_lower": 0.661309851706028,
      "variance_recovery_ci_upper": 0.856842876970768,
      "variance_recovery_bca_ci_lower": 0.6675327398852683,
      "variance_recovery_bca_ci_upper": 0.9052565070356453,
      "mse_std": 460.25262451171875,
      "mse_ci_lower": 27573.16064453125,
      "mse_ci_upper": 29352.901318359374,
      "r_squared": 0.9685850143432617,
      "r_squared_std": 0.0013832147233188152,
      "r_squared_ci_lower": 0.9663816824555397,
      "r_squared_ci_upper": 0.9714308470487595,
      "total_positions": 1024,
      "original_variance": 906214.5625,
      "original_mean": 15.710368156433105,
      "mean_variance_mean_over_hidden": 27882.107421875,
      "residual_variance_mean_over_hidden": 27882.107421875
    },
    {
      "k": 16,
      "avg_mse": 28001.865234375,
      "variance_recovery": 0.773491382598877,
      "variance_recovery_bias": -0.019585490226745605,
      "variance_recovery_bias_corrected": 0.7930768728256226,
      "variance_recovery_std": 0.06580717116594315,
      "variance_recovery_ci_lower": 0.666901533305645,
      "variance_recovery_ci_upper": 0.8592614963650703,
      "variance_recovery_bca_ci_lower": 0.6723598429639597,
      "variance_recovery_bca_ci_upper": 0.9064422455161175,
      "mse_std": 460.0726013183594,
      "mse_ci_lower": 27113.700341796874,
      "mse_ci_upper": 28909.3798828125,
      "r_squared": 0.9691001772880554,
      "r_squared_std": 0.001361339702270925,
      "r_squared_ci_lower": 0.9669072434306145,
      "r_squared_ci_upper": 0.9719304978847504,
      "total_positions": 1024,
      "original_variance": 906214.5625,
      "original_mean": 15.710368156433105,
      "mean_variance_mean_over_hidden": 27428.2890625,
      "residual_variance_mean_over_hidden": 27428.2890625
    },
    {
      "k": 32,
      "avg_mse": 27541.61328125,
      "variance_recovery": 0.7771945595741272,
      "variance_recovery_bias": -0.01927351951599121,
      "variance_recovery_bias_corrected": 0.7964680790901184,
      "variance_recovery_std": 0.0647025853395462,
      "variance_recovery_ci_lower": 0.6721648126840591,
      "variance_recovery_ci_upper": 0.8615174651145935,
      "variance_recovery_bca_ci_lower": 0.6783487560772297,
      "variance_recovery_bca_ci_upper": 0.9084117240143197,
      "mse_std": 451.4809265136719,
      "mse_ci_lower": 26664.79248046875,
      "mse_ci_upper": 28425.04990234375,
      "r_squared": 0.9696080684661865,
      "r_squared_std": 0.0013358541764318943,
      "r_squared_ci_lower": 0.9674646273255348,
      "r_squared_ci_upper": 0.972361896932125,
      "total_positions": 1024,
      "original_variance": 906214.5625,
      "original_mean": 15.710368156433105,
      "mean_variance_mean_over_hidden": 26979.859375,
      "residual_variance_mean_over_hidden": 26979.859375
    }
  ],
  "summary": {
    "k_values": [
      1.0,
      2.0,
      4.0,
      8.0,
      16.0,
      32.0
    ],
    "mse_values": [
      30899.53515625,
      29696.62890625,
      29019.42578125,
      28468.681640625,
      28001.865234375,
      27541.61328125
    ],
    "variance_recovery_values": [
      0.7502889633178711,
      0.7600265145301819,
      0.7654687762260437,
      0.7697436213493347,
      0.773491382598877,
      0.7771945595741272
    ],
    "r_squared_values": [
      0.9659026265144348,
      0.9672300219535828,
      0.9679772853851318,
      0.9685850143432617,
      0.9691001772880554,
      0.9696080684661865
    ]
  }
}