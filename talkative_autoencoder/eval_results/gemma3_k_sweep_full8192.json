{
  "checkpoint_path": "outputs/checkpoints/gemma3_CHAT_27b_frozen_nopostfix_GG32PAW1S_gemma-3-27b-it_L45_e45_frozen_lr3e-4_t8_4ep_resume_0722_171856_frozenenc_add_patch5_suffix1p0enc_NO_PROJ_IT_E_D_WILD_OTF_dist8/checkpoint_step399999_epoch240_final.pt",
  "eval_config": {
    "checkpoint_path": "outputs/checkpoints/gemma3_CHAT_27b_frozen_nopostfix_GG32PAW1S_gemma-3-27b-it_L45_e45_frozen_lr3e-4_t8_4ep_resume_0722_171856_frozenenc_add_patch5_suffix1p0enc_NO_PROJ_IT_E_D_WILD_OTF_dist8/checkpoint_step399999_epoch240_final.pt",
    "k_values": [
      1,
      2,
      4,
      8,
      16,
      32
    ],
    "max_batches": null,
    "output_dir": "./eval_results",
    "output_file": "gemma3_k_sweep_full8192.json",
    "batch_size": 8,
    "temperature": 1.0,
    "generation_batch_size": 64,
    "use_bf16": true,
    "dataloader_batch_size": 128,
    "vector_extraction_batch_size": 16,
    "num_positions": 1,
    "max_val_samples": 8192,
    "dataloader_fwd_pass_batch_size": 16
  },
  "results_by_k": [
    {
      "k": 1,
      "avg_mse": 34124.046875,
      "variance_recovery": 0.7965015172958374,
      "variance_recovery_bias": -0.0009376406669616699,
      "variance_recovery_bias_corrected": 0.7974391579627991,
      "variance_recovery_std": 0.025918200612068176,
      "variance_recovery_ci_lower": 0.7397633939981461,
      "variance_recovery_ci_upper": 0.8416292577981949,
      "variance_recovery_bca_ci_lower": 0.7410530986387426,
      "variance_recovery_bca_ci_upper": 0.8425384999344451,
      "mse_std": 3042.677490234375,
      "mse_ci_lower": 30687.7380859375,
      "mse_ci_upper": 40518.600390625,
      "r_squared": 0.964255690574646,
      "r_squared_std": 0.0030947597697377205,
      "r_squared_ci_lower": 0.9577239364385605,
      "r_squared_ci_upper": 0.9684753015637397,
      "total_positions": 8192,
      "original_variance": 954668.8125,
      "original_mean": 15.763453483581543,
      "mean_variance_mean_over_hidden": 33463.47265625,
      "residual_variance_mean_over_hidden": 33463.47265625
    },
    {
      "k": 2,
      "avg_mse": 33082.6171875,
      "variance_recovery": 0.8025904297828674,
      "variance_recovery_bias": -0.0008856058120727539,
      "variance_recovery_bias_corrected": 0.8034760355949402,
      "variance_recovery_std": 0.025421446189284325,
      "variance_recovery_ci_lower": 0.7465126171708107,
      "variance_recovery_ci_upper": 0.8462667092680931,
      "variance_recovery_bca_ci_lower": 0.7468524275656873,
      "variance_recovery_bca_ci_upper": 0.8464292987936868,
      "mse_std": 3043.226806640625,
      "mse_ci_lower": 29634.732568359374,
      "mse_ci_upper": 39445.9900390625,
      "r_squared": 0.9653464555740356,
      "r_squared_std": 0.0030942170415073633,
      "r_squared_ci_lower": 0.9588156118988991,
      "r_squared_ci_upper": 0.9695658996701241,
      "total_positions": 8192,
      "original_variance": 954668.8125,
      "original_mean": 15.763453483581543,
      "mean_variance_mean_over_hidden": 32462.208984375,
      "residual_variance_mean_over_hidden": 32462.208984375
    },
    {
      "k": 4,
      "avg_mse": 29731.9140625,
      "variance_recovery": 0.8227595686912537,
      "variance_recovery_bias": -0.0011768341064453125,
      "variance_recovery_bias_corrected": 0.823936402797699,
      "variance_recovery_std": 0.01936565525829792,
      "variance_recovery_ci_lower": 0.7836281567811966,
      "variance_recovery_ci_upper": 0.8587528988718987,
      "variance_recovery_bca_ci_lower": 0.7875223663839536,
      "variance_recovery_bca_ci_upper": 0.8618827619762123,
      "mse_std": 534.262451171875,
      "mse_ci_lower": 28890.631640625,
      "mse_ci_upper": 30896.928369140624,
      "r_squared": 0.9688563346862793,
      "r_squared_std": 0.0007742128218524158,
      "r_squared_ci_lower": 0.9675010129809379,
      "r_squared_ci_upper": 0.9704919710755349,
      "total_positions": 8192,
      "original_variance": 954668.8125,
      "original_mean": 15.763453483581543,
      "mean_variance_mean_over_hidden": 29145.580078125,
      "residual_variance_mean_over_hidden": 29145.580078125
    },
    {
      "k": 8,
      "avg_mse": 28787.609375,
      "variance_recovery": 0.8284127712249756,
      "variance_recovery_bias": -0.001197218894958496,
      "variance_recovery_bias_corrected": 0.8296099901199341,
      "variance_recovery_std": 0.018970312550663948,
      "variance_recovery_ci_lower": 0.7906789347529412,
      "variance_recovery_ci_upper": 0.8632367551326752,
      "variance_recovery_bca_ci_lower": 0.7935594356425588,
      "variance_recovery_bca_ci_upper": 0.8662975824043522,
      "mse_std": 311.1120910644531,
      "mse_ci_lower": 28236.86875,
      "mse_ci_upper": 29455.9849609375,
      "r_squared": 0.9698454737663269,
      "r_squared_std": 0.0006817158428020775,
      "r_squared_ci_lower": 0.968704204261303,
      "r_squared_ci_upper": 0.9713486552238464,
      "total_positions": 8192,
      "original_variance": 954668.8125,
      "original_mean": 15.763453483581543,
      "mean_variance_mean_over_hidden": 28215.958984375,
      "residual_variance_mean_over_hidden": 28215.958984375
    },
    {
      "k": 16,
      "avg_mse": 31109.224609375,
      "variance_recovery": 0.8142801523208618,
      "variance_recovery_bias": -0.000816643238067627,
      "variance_recovery_bias_corrected": 0.8150967955589294,
      "variance_recovery_std": 0.02456905134022236,
      "variance_recovery_ci_lower": 0.7598732724785805,
      "variance_recovery_ci_upper": 0.8556610733270645,
      "variance_recovery_bca_ci_lower": 0.7568605661589992,
      "variance_recovery_bca_ci_upper": 0.8550635487784514,
      "mse_std": 3041.68603515625,
      "mse_ci_lower": 27723.14638671875,
      "mse_ci_upper": 37443.36748046875,
      "r_squared": 0.9674135446548462,
      "r_squared_std": 0.0030957218259572983,
      "r_squared_ci_lower": 0.9608553379774094,
      "r_squared_ci_upper": 0.9716022625565529,
      "total_positions": 8192,
      "original_variance": 954668.8125,
      "original_mean": 15.763453483581543,
      "mean_variance_mean_over_hidden": 30539.9375,
      "residual_variance_mean_over_hidden": 30539.9375
    },
    {
      "k": 32,
      "avg_mse": 27888.84765625,
      "variance_recovery": 0.833759069442749,
      "variance_recovery_bias": -0.001156151294708252,
      "variance_recovery_bias_corrected": 0.8349152207374573,
      "variance_recovery_std": 0.01835773140192032,
      "variance_recovery_ci_lower": 0.797051590681076,
      "variance_recovery_ci_upper": 0.8674893468618393,
      "variance_recovery_bca_ci_lower": 0.8000186189036833,
      "variance_recovery_bca_ci_upper": 0.8703969455415611,
      "mse_std": 309.6015930175781,
      "mse_ci_lower": 27350.8318359375,
      "mse_ci_upper": 28547.725537109374,
      "r_squared": 0.9707868695259094,
      "r_squared_std": 0.0006608437397517264,
      "r_squared_ci_lower": 0.9696943029761315,
      "r_squared_ci_upper": 0.9722375974059105,
      "total_positions": 8192,
      "original_variance": 954668.8125,
      "original_mean": 15.763453483581543,
      "mean_variance_mean_over_hidden": 27336.80859375,
      "residual_variance_mean_over_hidden": 27336.80859375
    }
  ],
  "summary": {
    "k_values": [
      1.0,
      2.0,
      4.0,
      8.0,
      16.0,
      32.0
    ],
    "mse_values": [
      34124.046875,
      33082.6171875,
      29731.9140625,
      28787.609375,
      31109.224609375,
      27888.84765625
    ],
    "variance_recovery_values": [
      0.7965015172958374,
      0.8025904297828674,
      0.8227595686912537,
      0.8284127712249756,
      0.8142801523208618,
      0.833759069442749
    ],
    "r_squared_values": [
      0.964255690574646,
      0.9653464555740356,
      0.9688563346862793,
      0.9698454737663269,
      0.9674135446548462,
      0.9707868695259094
    ]
  }
}