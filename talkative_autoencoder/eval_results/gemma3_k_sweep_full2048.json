{
  "checkpoint_path": "outputs/checkpoints/gemma3_CHAT_27b_frozen_nopostfix_GG32PAW1S_gemma-3-27b-it_L45_e45_frozen_lr3e-4_t8_4ep_resume_0722_171856_frozenenc_add_patch5_suffix1p0enc_NO_PROJ_IT_E_D_WILD_OTF_dist8/checkpoint_step399999_epoch240_final.pt",
  "eval_config": {
    "checkpoint_path": "outputs/checkpoints/gemma3_CHAT_27b_frozen_nopostfix_GG32PAW1S_gemma-3-27b-it_L45_e45_frozen_lr3e-4_t8_4ep_resume_0722_171856_frozenenc_add_patch5_suffix1p0enc_NO_PROJ_IT_E_D_WILD_OTF_dist8/checkpoint_step399999_epoch240_final.pt",
    "k_values": [
      1,
      2,
      4,
      8,
      16,
      32
    ],
    "max_batches": null,
    "output_dir": "./eval_results",
    "output_file": "gemma3_k_sweep_full.json",
    "batch_size": 8,
    "temperature": 1.0,
    "generation_batch_size": 64,
    "use_bf16": true,
    "dataloader_batch_size": 128,
    "vector_extraction_batch_size": 16,
    "num_positions": 1,
    "max_val_samples": 2048,
    "dataloader_fwd_pass_batch_size": 16
  },
  "results_by_k": [
    {
      "k": 1,
      "avg_mse": 31109.03515625,
      "variance_recovery": 0.7019519209861755,
      "variance_recovery_bias": -0.00783926248550415,
      "variance_recovery_bias_corrected": 0.7097911834716797,
      "variance_recovery_std": 0.04855328053236008,
      "variance_recovery_ci_lower": 0.6308384731411933,
      "variance_recovery_ci_upper": 0.7824834197759628,
      "variance_recovery_bca_ci_lower": 0.6354398044882918,
      "variance_recovery_bca_ci_upper": 0.8286248893567315,
      "mse_std": 335.3723449707031,
      "mse_ci_lower": 30475.494970703126,
      "mse_ci_upper": 31771.446533203125,
      "r_squared": 0.9645559191703796,
      "r_squared_std": 0.0009628297993913293,
      "r_squared_ci_lower": 0.9630405083298683,
      "r_squared_ci_upper": 0.9666358754038811,
      "total_positions": 2048,
      "original_variance": 877693.8125,
      "original_mean": 15.723546981811523,
      "mean_variance_mean_over_hidden": 30442.96484375,
      "residual_variance_mean_over_hidden": 30442.96484375
    },
    {
      "k": 2,
      "avg_mse": 30052.88671875,
      "variance_recovery": 0.7118721008300781,
      "variance_recovery_bias": -0.0076018571853637695,
      "variance_recovery_bias_corrected": 0.7194739580154419,
      "variance_recovery_std": 0.046940527856349945,
      "variance_recovery_ci_lower": 0.6433194816112519,
      "variance_recovery_ci_upper": 0.7893066734075547,
      "variance_recovery_bca_ci_lower": 0.6476301751415496,
      "variance_recovery_bca_ci_upper": 0.8340456372123669,
      "mse_std": 326.8727111816406,
      "mse_ci_lower": 29450.56142578125,
      "mse_ci_upper": 30707.337890625,
      "r_squared": 0.96575927734375,
      "r_squared_std": 0.0009329491294920444,
      "r_squared_ci_lower": 0.9642534345388413,
      "r_squared_ci_upper": 0.967720989882946,
      "total_positions": 2048,
      "original_variance": 877693.8125,
      "original_mean": 15.723546981811523,
      "mean_variance_mean_over_hidden": 29429.703125,
      "residual_variance_mean_over_hidden": 29429.703125
    },
    {
      "k": 4,
      "avg_mse": 29294.5625,
      "variance_recovery": 0.7189607620239258,
      "variance_recovery_bias": -0.007388889789581299,
      "variance_recovery_bias_corrected": 0.7263496518135071,
      "variance_recovery_std": 0.0457906499505043,
      "variance_recovery_ci_lower": 0.652266401052475,
      "variance_recovery_ci_upper": 0.7943780899047852,
      "variance_recovery_bca_ci_lower": 0.656210783478579,
      "variance_recovery_bca_ci_upper": 0.8380432806332502,
      "mse_std": 316.07598876953125,
      "mse_ci_lower": 28697.778369140626,
      "mse_ci_upper": 29900.79609375,
      "r_squared": 0.9666232466697693,
      "r_squared_std": 0.0009110936662182212,
      "r_squared_ci_lower": 0.9651598140597344,
      "r_squared_ci_upper": 0.9685772672295571,
      "total_positions": 2048,
      "original_variance": 877693.8125,
      "original_mean": 15.723546981811523,
      "mean_variance_mean_over_hidden": 28705.6640625,
      "residual_variance_mean_over_hidden": 28705.6640625
    },
    {
      "k": 8,
      "avg_mse": 28619.91796875,
      "variance_recovery": 0.72545325756073,
      "variance_recovery_bias": -0.007232069969177246,
      "variance_recovery_bias_corrected": 0.7326853275299072,
      "variance_recovery_std": 0.0447365827858448,
      "variance_recovery_ci_lower": 0.660075943171978,
      "variance_recovery_ci_upper": 0.7990659207105637,
      "variance_recovery_bca_ci_lower": 0.6641943421838391,
      "variance_recovery_bca_ci_upper": 0.841145976742823,
      "mse_std": 308.9693298339844,
      "mse_ci_lower": 28058.02939453125,
      "mse_ci_upper": 29220.78701171875,
      "r_squared": 0.9673919081687927,
      "r_squared_std": 0.0008916112710721791,
      "r_squared_ci_lower": 0.965950258076191,
      "r_squared_ci_upper": 0.9692662551999092,
      "total_positions": 2048,
      "original_variance": 877693.8125,
      "original_mean": 15.723546981811523,
      "mean_variance_mean_over_hidden": 28042.51171875,
      "residual_variance_mean_over_hidden": 28042.51171875
    },
    {
      "k": 16,
      "avg_mse": 28141.38671875,
      "variance_recovery": 0.7300618290901184,
      "variance_recovery_bias": -0.00708615779876709,
      "variance_recovery_bias_corrected": 0.7371479868888855,
      "variance_recovery_std": 0.04399148002266884,
      "variance_recovery_ci_lower": 0.6657408103346825,
      "variance_recovery_ci_upper": 0.8025741338729858,
      "variance_recovery_bca_ci_lower": 0.6699170810913507,
      "variance_recovery_bca_ci_upper": 0.8456582833421518,
      "mse_std": 303.3527526855469,
      "mse_ci_lower": 27569.8556640625,
      "mse_ci_upper": 28712.36357421875,
      "r_squared": 0.9679371118545532,
      "r_squared_std": 0.0008786178077571094,
      "r_squared_ci_lower": 0.9665143504738808,
      "r_squared_ci_upper": 0.9697901025414467,
      "total_positions": 2048,
      "original_variance": 877693.8125,
      "original_mean": 15.723546981811523,
      "mean_variance_mean_over_hidden": 27571.78515625,
      "residual_variance_mean_over_hidden": 27571.78515625
    },
    {
      "k": 32,
      "avg_mse": 27726.66796875,
      "variance_recovery": 0.7339318990707397,
      "variance_recovery_bias": -0.006995081901550293,
      "variance_recovery_bias_corrected": 0.74092698097229,
      "variance_recovery_std": 0.04334114119410515,
      "variance_recovery_ci_lower": 0.6705595806241036,
      "variance_recovery_ci_upper": 0.8052676156163215,
      "variance_recovery_bca_ci_lower": 0.674581771025828,
      "variance_recovery_bca_ci_upper": 0.8474210073357603,
      "mse_std": 301.72637939453125,
      "mse_ci_lower": 27173.95419921875,
      "mse_ci_upper": 28308.21572265625,
      "r_squared": 0.9684096574783325,
      "r_squared_std": 0.0008649437222629786,
      "r_squared_ci_lower": 0.9669984206557274,
      "r_squared_ci_upper": 0.9702381014823913,
      "total_positions": 2048,
      "original_variance": 877693.8125,
      "original_mean": 15.723546981811523,
      "mean_variance_mean_over_hidden": 27176.494140625,
      "residual_variance_mean_over_hidden": 27176.494140625
    }
  ],
  "summary": {
    "k_values": [
      1.0,
      2.0,
      4.0,
      8.0,
      16.0,
      32.0
    ],
    "mse_values": [
      31109.03515625,
      30052.88671875,
      29294.5625,
      28619.91796875,
      28141.38671875,
      27726.66796875
    ],
    "variance_recovery_values": [
      0.7019519209861755,
      0.7118721008300781,
      0.7189607620239258,
      0.72545325756073,
      0.7300618290901184,
      0.7339318990707397
    ],
    "r_squared_values": [
      0.9645559191703796,
      0.96575927734375,
      0.9666232466697693,
      0.9673919081687927,
      0.9679371118545532,
      0.9684096574783325
    ]
  }
}