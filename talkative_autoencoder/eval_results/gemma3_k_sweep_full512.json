{
  "checkpoint_path": "outputs/checkpoints/gemma3_CHAT_27b_frozen_nopostfix_GG32PAW1S_gemma-3-27b-it_L45_e45_frozen_lr3e-4_t8_4ep_resume_0722_171856_frozenenc_add_patch5_suffix1p0enc_NO_PROJ_IT_E_D_WILD_OTF_dist8/checkpoint_step399999_epoch240_final.pt",
  "eval_config": {
    "checkpoint_path": "outputs/checkpoints/gemma3_CHAT_27b_frozen_nopostfix_GG32PAW1S_gemma-3-27b-it_L45_e45_frozen_lr3e-4_t8_4ep_resume_0722_171856_frozenenc_add_patch5_suffix1p0enc_NO_PROJ_IT_E_D_WILD_OTF_dist8/checkpoint_step399999_epoch240_final.pt",
    "k_values": [
      1,
      2,
      4,
      8,
      16,
      32
    ],
    "max_batches": null,
    "output_dir": "./eval_results",
    "output_file": "gemma3_k_sweep_full512.json",
    "batch_size": 8,
    "temperature": 1.0,
    "generation_batch_size": 64,
    "use_bf16": true,
    "dataloader_batch_size": 128,
    "vector_extraction_batch_size": 16,
    "num_positions": 1,
    "max_val_samples": 512,
    "dataloader_fwd_pass_batch_size": 16
  },
  "results_by_k": [
    {
      "k": 1,
      "avg_mse": 30502.7265625,
      "variance_recovery": 0.872279942035675,
      "variance_recovery_bias": -0.027321577072143555,
      "variance_recovery_bias_corrected": 0.8996015191078186,
      "variance_recovery_std": 0.07708219438791275,
      "variance_recovery_ci_lower": 0.6526940733194351,
      "variance_recovery_ci_upper": 0.9333282068371773,
      "variance_recovery_bca_ci_lower": 0.6619563927123193,
      "variance_recovery_bca_ci_upper": 0.9461099691924946,
      "mse_std": 648.4862060546875,
      "mse_ci_lower": 29342.611669921876,
      "mse_ci_upper": 31916.0439453125,
      "r_squared": 0.9707561731338501,
      "r_squared_std": 0.003211879637092352,
      "r_squared_ci_lower": 0.9643743157386779,
      "r_squared_ci_upper": 0.9764923825860023,
      "total_positions": 512,
      "original_variance": 1043048.0625,
      "original_mean": 16.05902862548828,
      "mean_variance_mean_over_hidden": 29885.16015625,
      "residual_variance_mean_over_hidden": 29885.16015625
    },
    {
      "k": 2,
      "avg_mse": 29426.296875,
      "variance_recovery": 0.8767570853233337,
      "variance_recovery_bias": -0.026372075080871582,
      "variance_recovery_bias_corrected": 0.9031291604042053,
      "variance_recovery_std": 0.07436399906873703,
      "variance_recovery_ci_lower": 0.6648489773273468,
      "variance_recovery_ci_upper": 0.9357096046209336,
      "variance_recovery_bca_ci_lower": 0.6733396371026817,
      "variance_recovery_bca_ci_upper": 0.9469109820955164,
      "mse_std": 630.9744873046875,
      "mse_ci_lower": 28315.25302734375,
      "mse_ci_upper": 30801.786865234375,
      "r_squared": 0.9717881679534912,
      "r_squared_std": 0.0030916284304112196,
      "r_squared_ci_lower": 0.9656266734004021,
      "r_squared_ci_upper": 0.977332966029644,
      "total_positions": 512,
      "original_variance": 1043048.0625,
      "original_mean": 16.05902862548828,
      "mean_variance_mean_over_hidden": 28837.55859375,
      "residual_variance_mean_over_hidden": 28837.55859375
    },
    {
      "k": 4,
      "avg_mse": 28599.998046875,
      "variance_recovery": 0.8802432417869568,
      "variance_recovery_bias": -0.0255814790725708,
      "variance_recovery_bias_corrected": 0.9058247208595276,
      "variance_recovery_std": 0.07221909612417221,
      "variance_recovery_ci_lower": 0.6746918901801109,
      "variance_recovery_ci_upper": 0.93753232806921,
      "variance_recovery_bca_ci_lower": 0.6821880837556684,
      "variance_recovery_bca_ci_upper": 0.9480286134950665,
      "mse_std": 622.5701293945312,
      "mse_ci_lower": 27438.57998046875,
      "mse_ci_upper": 29959.071875,
      "r_squared": 0.9725803732872009,
      "r_squared_std": 0.002997133880853653,
      "r_squared_ci_lower": 0.9665896400809288,
      "r_squared_ci_upper": 0.9780118122696877,
      "total_positions": 512,
      "original_variance": 1043048.0625,
      "original_mean": 16.05902862548828,
      "mean_variance_mean_over_hidden": 28021.833984375,
      "residual_variance_mean_over_hidden": 28021.833984375
    },
    {
      "k": 8,
      "avg_mse": 28028.662109375,
      "variance_recovery": 0.882544994354248,
      "variance_recovery_bias": -0.025079429149627686,
      "variance_recovery_bias_corrected": 0.9076244235038757,
      "variance_recovery_std": 0.07079719007015228,
      "variance_recovery_ci_lower": 0.681122536957264,
      "variance_recovery_ci_upper": 0.9386670768260956,
      "variance_recovery_bca_ci_lower": 0.689415920626704,
      "variance_recovery_bca_ci_upper": 0.950779745603995,
      "mse_std": 603.9138793945312,
      "mse_ci_lower": 26914.614697265624,
      "mse_ci_upper": 29371.806884765625,
      "r_squared": 0.973128080368042,
      "r_squared_std": 0.002933874260634184,
      "r_squared_ci_lower": 0.9672497943043709,
      "r_squared_ci_upper": 0.9784218803048134,
      "total_positions": 512,
      "original_variance": 1043048.0625,
      "original_mean": 16.05902862548828,
      "mean_variance_mean_over_hidden": 27483.244140625,
      "residual_variance_mean_over_hidden": 27483.244140625
    },
    {
      "k": 16,
      "avg_mse": 27529.77734375,
      "variance_recovery": 0.8846861124038696,
      "variance_recovery_bias": -0.024610519409179688,
      "variance_recovery_bias_corrected": 0.9092966318130493,
      "variance_recovery_std": 0.06947371363639832,
      "variance_recovery_ci_lower": 0.687343667447567,
      "variance_recovery_ci_upper": 0.9397988557815552,
      "variance_recovery_bca_ci_lower": 0.6946924394769183,
      "variance_recovery_bca_ci_upper": 0.9511442932473154,
      "mse_std": 595.99267578125,
      "mse_ci_lower": 26446.26064453125,
      "mse_ci_upper": 28795.504296875,
      "r_squared": 0.9736064076423645,
      "r_squared_std": 0.002879852196201682,
      "r_squared_ci_lower": 0.9678811609745026,
      "r_squared_ci_upper": 0.9787636965513229,
      "total_positions": 512,
      "original_variance": 1043048.0625,
      "original_mean": 16.05902862548828,
      "mean_variance_mean_over_hidden": 26982.25,
      "residual_variance_mean_over_hidden": 26982.25
    },
    {
      "k": 32,
      "avg_mse": 27155.03125,
      "variance_recovery": 0.8862365484237671,
      "variance_recovery_bias": -0.02428281307220459,
      "variance_recovery_bias_corrected": 0.9105193614959717,
      "variance_recovery_std": 0.06853677332401276,
      "variance_recovery_ci_lower": 0.6914831757545471,
      "variance_recovery_ci_upper": 0.9405735909938813,
      "variance_recovery_bca_ci_lower": 0.6992072253885843,
      "variance_recovery_bca_ci_upper": 0.951589189109103,
      "mse_std": 587.1591186523438,
      "mse_ci_lower": 26092.751806640626,
      "mse_ci_upper": 28449.84189453125,
      "r_squared": 0.9739657044410706,
      "r_squared_std": 0.0028387168422341347,
      "r_squared_ci_lower": 0.9682563200592995,
      "r_squared_ci_upper": 0.9790552526712417,
      "total_positions": 512,
      "original_variance": 1043048.0625,
      "original_mean": 16.05902862548828,
      "mean_variance_mean_over_hidden": 26619.466796875,
      "residual_variance_mean_over_hidden": 26619.466796875
    }
  ],
  "summary": {
    "k_values": [
      1.0,
      2.0,
      4.0,
      8.0,
      16.0,
      32.0
    ],
    "mse_values": [
      30502.7265625,
      29426.296875,
      28599.998046875,
      28028.662109375,
      27529.77734375,
      27155.03125
    ],
    "variance_recovery_values": [
      0.872279942035675,
      0.8767570853233337,
      0.8802432417869568,
      0.882544994354248,
      0.8846861124038696,
      0.8862365484237671
    ],
    "r_squared_values": [
      0.9707561731338501,
      0.9717881679534912,
      0.9725803732872009,
      0.973128080368042,
      0.9736064076423645,
      0.9739657044410706
    ]
  }
}