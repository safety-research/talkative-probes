{
  "checkpoint_path": "outputs/checkpoints/gemma3_CHAT_27b_frozen_nopostfix_GG32PAW1S_gemma-3-27b-it_L45_e45_frozen_lr3e-4_t8_4ep_resume_0722_171856_frozenenc_add_patch5_suffix1p0enc_NO_PROJ_IT_E_D_WILD_OTF_dist8/checkpoint_step399999_epoch240_final.pt",
  "eval_config": {
    "checkpoint_path": "outputs/checkpoints/gemma3_CHAT_27b_frozen_nopostfix_GG32PAW1S_gemma-3-27b-it_L45_e45_frozen_lr3e-4_t8_4ep_resume_0722_171856_frozenenc_add_patch5_suffix1p0enc_NO_PROJ_IT_E_D_WILD_OTF_dist8/checkpoint_step399999_epoch240_final.pt",
    "k_values": [
      1,
      2,
      4,
      8,
      16,
      32
    ],
    "max_batches": null,
    "output_dir": "./eval_results",
    "output_file": "gemma3_k_sweep_full256.json",
    "batch_size": 8,
    "temperature": 1.0,
    "generation_batch_size": 64,
    "use_bf16": true,
    "dataloader_batch_size": 128,
    "vector_extraction_batch_size": 16,
    "num_positions": 1,
    "max_val_samples": 256,
    "dataloader_fwd_pass_batch_size": 16
  },
  "results_by_k": [
    {
      "k": 1,
      "avg_mse": 28698.685546875,
      "variance_recovery": 0.8588505387306213,
      "variance_recovery_bias": -0.05500829219818115,
      "variance_recovery_bias_corrected": 0.9138588309288025,
      "variance_recovery_std": 0.11302511394023895,
      "variance_recovery_ci_lower": 0.637107340991497,
      "variance_recovery_ci_upper": 0.9366467967629433,
      "variance_recovery_bca_ci_lower": 0.6460031126611685,
      "variance_recovery_bca_ci_upper": 0.9591103065394516,
      "mse_std": 684.7708740234375,
      "mse_ci_lower": 27323.299462890624,
      "mse_ci_upper": 30081.0080078125,
      "r_squared": 0.9725337624549866,
      "r_squared_std": 0.003693891689181328,
      "r_squared_ci_lower": 0.9668283745646477,
      "r_squared_ci_upper": 0.9793094173073769,
      "total_positions": 256,
      "original_variance": 1044871.5,
      "original_mean": 16.484535217285156,
      "mean_variance_mean_over_hidden": 28162.18359375,
      "residual_variance_mean_over_hidden": 28162.18359375
    },
    {
      "k": 2,
      "avg_mse": 27851.216796875,
      "variance_recovery": 0.863175630569458,
      "variance_recovery_bias": -0.053430140018463135,
      "variance_recovery_bias_corrected": 0.9166057705879211,
      "variance_recovery_std": 0.10982485115528107,
      "variance_recovery_ci_lower": 0.6469355151057243,
      "variance_recovery_ci_upper": 0.9386901915073395,
      "variance_recovery_bca_ci_lower": 0.6560826318584282,
      "variance_recovery_bca_ci_upper": 0.9600904652077905,
      "mse_std": 659.2335815429688,
      "mse_ci_lower": 26502.778515625,
      "mse_ci_upper": 29153.6974609375,
      "r_squared": 0.9733448028564453,
      "r_squared_std": 0.0036163716576993465,
      "r_squared_ci_lower": 0.9677515402436256,
      "r_squared_ci_upper": 0.9799906626343727,
      "total_positions": 256,
      "original_variance": 1044871.5,
      "original_mean": 16.484535217285156,
      "mean_variance_mean_over_hidden": 27299.23828125,
      "residual_variance_mean_over_hidden": 27299.23828125
    },
    {
      "k": 4,
      "avg_mse": 26950.21875,
      "variance_recovery": 0.8676007390022278,
      "variance_recovery_bias": -0.05160975456237793,
      "variance_recovery_bias_corrected": 0.9192104935646057,
      "variance_recovery_std": 0.10596604645252228,
      "variance_recovery_ci_lower": 0.6590151831507682,
      "variance_recovery_ci_upper": 0.9405814796686173,
      "variance_recovery_bca_ci_lower": 0.669079655072092,
      "variance_recovery_bca_ci_upper": 0.9619219629228191,
      "mse_std": 610.593994140625,
      "mse_ci_lower": 25712.40859375,
      "mse_ci_upper": 28156.778271484374,
      "r_squared": 0.9742071032524109,
      "r_squared_std": 0.003460983280092478,
      "r_squared_ci_lower": 0.9688605293631554,
      "r_squared_ci_upper": 0.9805921986699104,
      "total_positions": 256,
      "original_variance": 1044871.5,
      "original_mean": 16.484535217285156,
      "mean_variance_mean_over_hidden": 26416.341796875,
      "residual_variance_mean_over_hidden": 26416.341796875
    },
    {
      "k": 8,
      "avg_mse": 26461.82421875,
      "variance_recovery": 0.8699814677238464,
      "variance_recovery_bias": -0.05090707540512085,
      "variance_recovery_bias_corrected": 0.9208885431289673,
      "variance_recovery_std": 0.10452228784561157,
      "variance_recovery_ci_lower": 0.6640731260180474,
      "variance_recovery_ci_upper": 0.9418232545256615,
      "variance_recovery_bca_ci_lower": 0.6741802540410641,
      "variance_recovery_bca_ci_upper": 0.9627631677981822,
      "mse_std": 610.8603515625,
      "mse_ci_lower": 25266.393359375,
      "mse_ci_upper": 27665.53154296875,
      "r_squared": 0.9746745824813843,
      "r_squared_std": 0.0034542588982731104,
      "r_squared_ci_lower": 0.9693024888634681,
      "r_squared_ci_upper": 0.9811601892113686,
      "total_positions": 256,
      "original_variance": 1044871.5,
      "original_mean": 16.484535217285156,
      "mean_variance_mean_over_hidden": 25941.341796875,
      "residual_variance_mean_over_hidden": 25941.341796875
    },
    {
      "k": 16,
      "avg_mse": 26055.650390625,
      "variance_recovery": 0.8720367550849915,
      "variance_recovery_bias": -0.050124287605285645,
      "variance_recovery_bias_corrected": 0.9221610426902771,
      "variance_recovery_std": 0.10287468135356903,
      "variance_recovery_ci_lower": 0.6691151469945907,
      "variance_recovery_ci_upper": 0.9427931234240532,
      "variance_recovery_bca_ci_lower": 0.6787545362535478,
      "variance_recovery_bca_ci_upper": 0.9628644281475784,
      "mse_std": 596.010986328125,
      "mse_ci_lower": 24869.47412109375,
      "mse_ci_upper": 27236.945654296873,
      "r_squared": 0.9750632643699646,
      "r_squared_std": 0.00340483826585114,
      "r_squared_ci_lower": 0.969751025736332,
      "r_squared_ci_upper": 0.9814130619168282,
      "total_positions": 256,
      "original_variance": 1044871.5,
      "original_mean": 16.484535217285156,
      "mean_variance_mean_over_hidden": 25531.267578125,
      "residual_variance_mean_over_hidden": 25531.267578125
    },
    {
      "k": 32,
      "avg_mse": 25691.14453125,
      "variance_recovery": 0.8737559914588928,
      "variance_recovery_bias": -0.049440085887908936,
      "variance_recovery_bias_corrected": 0.9231960773468018,
      "variance_recovery_std": 0.10151149332523346,
      "variance_recovery_ci_lower": 0.6739761680364609,
      "variance_recovery_ci_upper": 0.9437811836600304,
      "variance_recovery_bca_ci_lower": 0.6830849463335793,
      "variance_recovery_bca_ci_upper": 0.9636854123550819,
      "mse_std": 590.0499877929688,
      "mse_ci_lower": 24506.98701171875,
      "mse_ci_upper": 26837.423974609374,
      "r_squared": 0.975412130355835,
      "r_squared_std": 0.0033605839125812054,
      "r_squared_ci_lower": 0.9702146351337433,
      "r_squared_ci_upper": 0.9817146927118301,
      "total_positions": 256,
      "original_variance": 1044871.5,
      "original_mean": 16.484535217285156,
      "mean_variance_mean_over_hidden": 25188.244140625,
      "residual_variance_mean_over_hidden": 25188.244140625
    }
  ],
  "summary": {
    "k_values": [
      1.0,
      2.0,
      4.0,
      8.0,
      16.0,
      32.0
    ],
    "mse_values": [
      28698.685546875,
      27851.216796875,
      26950.21875,
      26461.82421875,
      26055.650390625,
      25691.14453125
    ],
    "variance_recovery_values": [
      0.8588505387306213,
      0.863175630569458,
      0.8676007390022278,
      0.8699814677238464,
      0.8720367550849915,
      0.8737559914588928
    ],
    "r_squared_values": [
      0.9725337624549866,
      0.9733448028564453,
      0.9742071032524109,
      0.9746745824813843,
      0.9750632643699646,
      0.975412130355835
    ]
  }
}