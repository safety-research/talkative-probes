{
  "checkpoint_path": "outputs/checkpoints/gemma3_CHAT_27b_frozen_nopostfix_GG32PAW1S_gemma-3-27b-it_L45_e45_frozen_lr3e-4_t8_4ep_resume_0722_171856_frozenenc_add_patch5_suffix1p0enc_NO_PROJ_IT_E_D_WILD_OTF_dist8/checkpoint_step399999_epoch240_final.pt",
  "eval_config": {
    "checkpoint_path": "outputs/checkpoints/gemma3_CHAT_27b_frozen_nopostfix_GG32PAW1S_gemma-3-27b-it_L45_e45_frozen_lr3e-4_t8_4ep_resume_0722_171856_frozenenc_add_patch5_suffix1p0enc_NO_PROJ_IT_E_D_WILD_OTF_dist8/checkpoint_step399999_epoch240_final.pt",
    "k_values": [
      1,
      2,
      4,
      8,
      16,
      32
    ],
    "max_batches": null,
    "output_dir": "./eval_results",
    "output_file": "gemma3_k_sweep_full4096.json",
    "batch_size": 8,
    "temperature": 1.0,
    "generation_batch_size": 64,
    "use_bf16": true,
    "dataloader_batch_size": 128,
    "vector_extraction_batch_size": 16,
    "num_positions": 1,
    "max_val_samples": 4096,
    "dataloader_fwd_pass_batch_size": 16
  },
  "results_by_k": [
    {
      "k": 1,
      "avg_mse": 38638.328125,
      "variance_recovery": 0.7486705780029297,
      "variance_recovery_bias": -0.005032896995544434,
      "variance_recovery_bias_corrected": 0.7537034749984741,
      "variance_recovery_std": 0.0520860031247139,
      "variance_recovery_ci_lower": 0.6271898910403252,
      "variance_recovery_ci_upper": 0.8286522522568702,
      "variance_recovery_bca_ci_lower": 0.6083652584522325,
      "variance_recovery_bca_ci_upper": 0.8224616216029251,
      "mse_std": 7342.34716796875,
      "mse_ci_lower": 30487.06015625,
      "mse_ci_upper": 54296.471386718746,
      "r_squared": 0.958821177482605,
      "r_squared_std": 0.007466370705515146,
      "r_squared_ci_lower": 0.9425838306546211,
      "r_squared_ci_upper": 0.9676397144794464,
      "total_positions": 4096,
      "original_variance": 938307.5,
      "original_mean": 15.8020658493042,
      "mean_variance_mean_over_hidden": 37969.296875,
      "residual_variance_mean_over_hidden": 37969.296875
    },
    {
      "k": 2,
      "avg_mse": 37083.0625,
      "variance_recovery": 0.758630096912384,
      "variance_recovery_bias": -0.004961252212524414,
      "variance_recovery_bias_corrected": 0.7635913491249084,
      "variance_recovery_std": 0.05094004422426224,
      "variance_recovery_ci_lower": 0.6399149999022484,
      "variance_recovery_ci_upper": 0.8366737633943557,
      "variance_recovery_bca_ci_lower": 0.620322398826851,
      "variance_recovery_bca_ci_upper": 0.8311147994442033,
      "mse_std": 7136.99169921875,
      "mse_ci_lower": 29383.603564453126,
      "mse_ci_upper": 52058.97802734375,
      "r_squared": 0.9604787230491638,
      "r_squared_std": 0.007277861703187227,
      "r_squared_ci_lower": 0.944504714012146,
      "r_squared_ci_upper": 0.9691112741827965,
      "total_positions": 4096,
      "original_variance": 938307.5,
      "original_mean": 15.8020658493042,
      "mean_variance_mean_over_hidden": 36464.671875,
      "residual_variance_mean_over_hidden": 36464.671875
    },
    {
      "k": 4,
      "avg_mse": 36221.51953125,
      "variance_recovery": 0.7642264366149902,
      "variance_recovery_bias": -0.004842579364776611,
      "variance_recovery_bias_corrected": 0.7690690159797668,
      "variance_recovery_std": 0.050618696957826614,
      "variance_recovery_ci_lower": 0.6458536624908447,
      "variance_recovery_ci_upper": 0.842698621749878,
      "variance_recovery_bca_ci_lower": 0.6259418371479092,
      "variance_recovery_bca_ci_upper": 0.8353089563378131,
      "mse_std": 7131.52490234375,
      "mse_ci_lower": 28610.74814453125,
      "mse_ci_upper": 51080.3517578125,
      "r_squared": 0.9613970518112183,
      "r_squared_std": 0.007281291764229536,
      "r_squared_ci_lower": 0.9454103469848633,
      "r_squared_ci_upper": 0.9699906244874,
      "total_positions": 4096,
      "original_variance": 938307.5,
      "original_mean": 15.8020658493042,
      "mean_variance_mean_over_hidden": 35619.21484375,
      "residual_variance_mean_over_hidden": 35619.21484375
    },
    {
      "k": 8,
      "avg_mse": 35366.59375,
      "variance_recovery": 0.7697378396987915,
      "variance_recovery_bias": -0.004787087440490723,
      "variance_recovery_bias_corrected": 0.7745249271392822,
      "variance_recovery_std": 0.05009431019425392,
      "variance_recovery_ci_lower": 0.6526848673820496,
      "variance_recovery_ci_upper": 0.8470640048384667,
      "variance_recovery_bca_ci_lower": 0.6320909025107713,
      "variance_recovery_bca_ci_upper": 0.8405475557527291,
      "mse_std": 7055.775390625,
      "mse_ci_lower": 27962.9615234375,
      "mse_ci_upper": 49797.44970703125,
      "r_squared": 0.9623080492019653,
      "r_squared_std": 0.007214314304292202,
      "r_squared_ci_lower": 0.9463418200612068,
      "r_squared_ci_upper": 0.9709224969148635,
      "total_positions": 4096,
      "original_variance": 938307.5,
      "original_mean": 15.8020658493042,
      "mean_variance_mean_over_hidden": 34786.58203125,
      "residual_variance_mean_over_hidden": 34786.58203125
    },
    {
      "k": 16,
      "avg_mse": 34663.484375,
      "variance_recovery": 0.7743212580680847,
      "variance_recovery_bias": -0.004701375961303711,
      "variance_recovery_bias_corrected": 0.7790226340293884,
      "variance_recovery_std": 0.047874726355075836,
      "variance_recovery_ci_lower": 0.6626999825239182,
      "variance_recovery_ci_upper": 0.8488101065158844,
      "variance_recovery_bca_ci_lower": 0.6450139232354605,
      "variance_recovery_bca_ci_upper": 0.8424113332963313,
      "mse_std": 6688.34130859375,
      "mse_ci_lower": 27535.5142578125,
      "mse_ci_upper": 48551.005859375,
      "r_squared": 0.9630573987960815,
      "r_squared_std": 0.006826416589319706,
      "r_squared_ci_lower": 0.947999183833599,
      "r_squared_ci_upper": 0.971185976266861,
      "total_positions": 4096,
      "original_variance": 938307.5,
      "original_mean": 15.8020658493042,
      "mean_variance_mean_over_hidden": 34094.1484375,
      "residual_variance_mean_over_hidden": 34094.1484375
    },
    {
      "k": 32,
      "avg_mse": 34512.9296875,
      "variance_recovery": 0.7752347588539124,
      "variance_recovery_bias": -0.0046135783195495605,
      "variance_recovery_bias_corrected": 0.7798483371734619,
      "variance_recovery_std": 0.050085343420505524,
      "variance_recovery_ci_lower": 0.657197117805481,
      "variance_recovery_ci_upper": 0.8525554329156876,
      "variance_recovery_bca_ci_lower": 0.6361942396434582,
      "variance_recovery_bca_ci_upper": 0.8454014439391101,
      "mse_std": 7127.90380859375,
      "mse_ci_lower": 27063.402392578126,
      "mse_ci_upper": 48994.17568359375,
      "r_squared": 0.9632177948951721,
      "r_squared_std": 0.00729644438251853,
      "r_squared_ci_lower": 0.9471163019537926,
      "r_squared_ci_upper": 0.9719092637300492,
      "total_positions": 4096,
      "original_variance": 938307.5,
      "original_mean": 15.8020658493042,
      "mean_variance_mean_over_hidden": 33956.14453125,
      "residual_variance_mean_over_hidden": 33956.14453125
    }
  ],
  "summary": {
    "k_values": [
      1.0,
      2.0,
      4.0,
      8.0,
      16.0,
      32.0
    ],
    "mse_values": [
      38638.328125,
      37083.0625,
      36221.51953125,
      35366.59375,
      34663.484375,
      34512.9296875
    ],
    "variance_recovery_values": [
      0.7486705780029297,
      0.758630096912384,
      0.7642264366149902,
      0.7697378396987915,
      0.7743212580680847,
      0.7752347588539124
    ],
    "r_squared_values": [
      0.958821177482605,
      0.9604787230491638,
      0.9613970518112183,
      0.9623080492019653,
      0.9630573987960815,
      0.9632177948951721
    ]
  }
}